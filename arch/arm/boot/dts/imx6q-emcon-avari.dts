/*
 * Copyright (C) 2017 emtrion GmbH
 * Author: Jan Tuerk  <jan.tuerk@emtrion.com>
 *
 * The code contained herein is licensed under the GNU General Public
 * License. You may obtain a copy of the GNU General Public License
 * Version 2 or later at the following locations:
 *
 * http://www.opensource.org/licenses/gpl-license.html
 * http://www.gnu.org/copyleft/gpl.html
 *
 * SPDX-License-Identifier: GPL-2.0
 *
 */

/dts-v1/;
#include "imx6q.dtsi"
#include "imx6qdl-emcon.dtsi"
#include "imx6q-emcon.dtsi" /*Include camera2 pinmux*/

/ {
	model = "emtrion SoM emCON-MX6 Dual/Quad on Avari";
	compatible = "emtrion,emcon-mx6-avari", "fsl,imx6q";

	aliases {
		mmc0 = &usdhc3;
		mmc2 = &usdhc1;
		mmc1 = &usdhc2;
		mmc3 = &usdhc4;
	};

	chosen {
		stdout-path = <&uart1>;
	};

	memory {
		reg = <0x10000000 0x40000000>;
	};

	supplies {
		compatible = "simple-bus";
		#address-cells = <1>;
		#size-cells = <0>;

		wallplug5p0: supply@0 {
			compatible = "regulator-fixed";
			reg = <0>;
			regulator-name = "WALL-PLUG";
			regulator-min-microvolt = <5000000>;
			regulator-max-microvolt = <5000000>;
			regulator-always-on;
			regulator-boot-on;
		};

		base3p3: supply@1 {
			compatible = "regulator-fixed";
			reg = <1>;
			vin-supply = <&wallplug5p0>;
			regulator-name = "3V3-avari";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			regulator-always-on;
			regulator-boot-on;
		};

		base1p5: supply@2 {
			compatible = "regulator-fixed";
			reg = <2>;
			vin-supply = <&base3p3>;
			regulator-name = "1V5-avari";
			regulator-min-microvolt = <1500000>;
			regulator-max-microvolt = <1500000>;
			regulator-always-on;
			regulator-boot-on;
		};

		reg_usb_otg: otgvbus@3 {
			compatible = "regulator-fixed";
			reg = <3>;
			vin-supply = <&wallplug5p0>;
			regulator-name = "OTG_VBUS";
			regulator-min-microvolt = <5000000>;
			regulator-max-microvolt = <5000000>;
			gpio = <&gpio1 8 GPIO_ACTIVE_LOW>;
			regulator-always-on;
		};

	};


	sndosc: 12MHZosc {
		compatible = "fixed-clock";
		#clock-cells = <0>;
		clock-frequency  = <12000000>;
	};

	sound {
		compatible = "fsl,imx-audio-sgtl5000";
		model = "emCON-avari-sgtl5000";
		ssi-controller = <&ssi2>;
		audio-codec = <&sgtl5000>;
		audio-routing =
			"Headphone Jack", "HP_OUT";
		mux-int-port = <2>;
		mux-ext-port = <3>;
	};

};


&iomuxc {
	pinctrl-names = "default";
	/*Unused emCON-MX6 pingroups on AVARI baseboard, enable defaults*/
	pinctrl-0 = <
				 &pinctrl_emcon_gpio1 &pinctrl_emcon_gpio2
				 &pinctrl_emcon_gpio3 &pinctrl_emcon_gpio5
				 &pinctrl_emcon_gpio6 &pinctrl_emcon_gpio7
				 &pinctrl_emcon_gpio8 &pinctrl_emcon_irq_a
				 &pinctrl_emcon_irq_b &pinctrl_emcon_irq_c
				 &pinctrl_emcon_irq_pwr &pinctrl_nor_flash
				 &pinctrl_usdhc2
				 &pinctrl_spdif_out     &pinctrl_spdif_in
				 &pinctrl_cpi1          &pinctrl_cpi2
				>;
};

&audmux {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_audmux>;
	status = "okay";
};



&i2c3 {
	clock-frequency = <100000>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_i2c3>;
	status = "okay";

	sgtl5000: audo-codec@0a {
		compatible = "fsl,sgtl5000";
		reg = <0x0a>;
		clocks = <&sndosc>;
		VDDA-supply = <&base3p3>;
		VDDIO-supply = <&base3p3>;
	};

	boardID: pca8754a@3a {
		compatible = "nxp,pca8574";
		reg = <0x3a>;
		gpio-controller;
		#gpio-cells = <1>;
	};

	captouch: touchscreen@38 {
		reg = <0x38>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_irq_touch2 &pinctrl_emcon_gpio4>;
		interrupt-parent = <&gpio6>;
		interrupts = <31 IRQ_TYPE_EDGE_FALLING>;
		compatible = "edt,edt-ft5406";
		wake-gpios = <&gpio2 3 GPIO_ACTIVE_HIGH>;
		wakeup-source;
	};
};

&ssi2 {
	status = "okay";
};

&rgb_encoder {
	status = "okay";
};

&rgb_panel {
	compatible = "edt,etm0700g0bdh6";
	status = "okay";
};

&i2c2 {
	status = "okay";
};

&hdmi {
	ddc-i2c-bus = <&i2c2>;
	status = "okay";
};

&usbh1 {
	status = "okay";
};

&usbotg {
	status = "okay";
};

&pcie {
	status = "okay";
};

&usdhc1 {
	status = "okay";
};

&can1 {
	status = "okay";
};

&can2 {
	status = "okay";
};

&uart2 {
	status = "okay";
	uart-has-rtscts;
};

&uart3 {
	status = "okay";
};

&uart4 {
	status = "okay";
};

&uart5 {
	status = "okay";
};

&ecspi2 {
	status = "okay";
};
