#!/bin/sh
# SPDX-License-Identifier: GPL-2.0
# description: Kprobe event argN argument

[ -f kprobe_events ] || exit_unsupported # this is configurable

grep -q "arg<N>" README || exit_unsupported # version issue

echo 0 > events/enable
echo > kprobe_events

: "Test bad pattern : arg0 is not allowed"
! echo 'p:testprobe create_trace_kprobe $arg0' > kprobe_events

: "Test get argument"
echo 'p:testprobe create_trace_kprobe $arg1' > kprobe_events
echo 1 > events/kprobes/testprobe/enable
! echo test >> kprobe_events
tail -n 1 trace | grep -qe "testprobe.* arg1=0x1"

! echo test test test >> kprobe_events
tail -n 1 trace | grep -qe "testprobe.* arg1=0x3"

echo 0 > events/enable
echo > kprobe_events
